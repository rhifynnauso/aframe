<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Pano Explorer</title>
    <meta name="description" content="Pano Explorer â€” vr-markup">
    <link rel="stylesheet" type="text/css" href="../../style/vr-markup.css">
    <link rel="stylesheet" type="text/css" href="../_style/main.css">
    <script src="../../build/vr-markup.js"></script>
  </head>
  <body>
    <vr-asset>
      <vr-mixin id="link" geometry="primitive: plane; width: 1.0; height: 1.0"></vr-mixin>
      <vr-mixin id="link-hovered" geometry="primitive: plane; width: 1.2; height: 1.2"></vr-mixin>
      <vr-mixin id="link-selected" geometry="primitive: plane; width: 1.4; height: 1.4"></vr-mixin>
      <vr-mixin id="cursor" geometry="primitive: ring; outerRadius: 0.20; innerRadius: 0.14" material="color: gray"></vr-mixin>
      <vr-mixin id="cursor-hovering" material="color: springgreen"></vr-mixin>
    </vr-asset>
    <vr-scene stats="true">

      <!-- Controls -->
      <vr-object camera="fov: 45" controls="mouselook: true; locomotion: false">
        <vr-object mixin="cursor" position="0 0 -3" cursor="timeout: 1500; fuse: true">
          <vr-animation begin="hovering" easing="ease-in" attribute="scale" from="1 1 1" to="0.2 0.2 0.2" dur="1500"></vr-animation>
        </vr-object>
      </vr-object>

      <!-- Pano -->
      <vr-object id="holder" geometry="primitive: sphere; radius: 10;"
                 material="receiveLight: false" scale="1 1 -1"></vr-object>

      <!-- Links to panos -->
      <vr-object id="links" position="-1 -0.3 -4">
      </vr-object>
    </vr-scene>

    <script>
      (function () {

        // Data for our panos
        var panos = [
          {
            'title': 'Cubes',
            'thumb': 'images/thumb-cubes.png',
            'url': 'images/cubes.jpg'
          },
          {
            'title': 'City',
            'thumb': 'images/thumb-city.png',
            'url': 'images/city.jpg'
          },
          {
            'title': 'Sechelt',
            'thumb': 'images/thumb-sechelt.png',
            'url': 'images/sechelt.jpg'
          }
        ];

        var links = document.querySelector('#links');
        var scene = document.querySelector('vr-scene');
        var holder = document.querySelector('#holder');
        var width = 1.0;
        var height = 1.0;
        var selectedLinkEl;

        // Create a link for each item in panos[]
        panos.forEach(function (pano, idx) {
          // Arrange the links horizontally without any overlaps
          var xPos = idx * width * 1.5;

          var el = document.createElement('vr-object');
          el.dataset.id = idx;
          el.setAttribute('position', {x: xPos});
          el.setAttribute('mixin', 'link');
          el.setAttribute('material', {src: 'url(' + pano.thumb + ')'});
          panos[idx].el = el;

          // When a link is clicked, change the displayed pano by changing the material attribute of the holder element
          el.addEventListener('click', handleClick);

          // Add the link to the links element
          links.appendChild(el);

        });

        if (scene.hasLoaded) {
          selectPano(1);
        } else {
          scene.addEventListener('loaded', function () { selectPano (1); });
        }

        function handleClick (evt) {
          var index = evt.currentTarget.dataset.id;
          selectPano(index);
        }

        function selectPano(index) {
          var pano = panos[index];
          var linkEL = pano.el;
          if (selectedLinkEl === pano.el) { return; }
          if (selectedLinkEl) { selectedLinkEl.removeState('selected'); }
          holder.setAttribute('material', {src: 'url(' + pano.url  + ')'});
          selectedLinkEl = linkEL;
          selectedLinkEl.addState('selected');
        }

      })();

    </script>

  </body>
</html>
